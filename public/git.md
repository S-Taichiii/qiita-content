---
title: 知ってて便利なGitのあれこれ!!!
tags:
  - "git"
  - "github"
  - "ソフトウェア開発"
private: false
updated_at: ""
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

# はじめに

Git を使っていて、「あれ、これどうするんだっけ？」とか「もっと楽にできる方法ないかな？」と思ったこと、ありませんか？
僕自身、最初は最低限のコマンドだけで何とかやってたんですが、ちょっとした知識を身につけるだけで作業が一気にスムーズになった経験が何度もあります。

この記事では、自分が「これ便利！」と思った Git の知識や使い方をゆるっと紹介していきます。
これから Git をもっと使いこなしたい人や、なんとなく使ってるけど今より効率よく使いたい人の参考になればうれしいです！

## 超基本的なコマンド

- `git init`: リポジトリを新規作成、初期化
- `git add foo`: ファイルfooをステージング
- `git commit -m "msg"`: メッセージmsgをつけてコミット
- `git log`: コミット履歴を表示
  - `--oneline`: コミット履歴を省略して表示
  - `--graph`: コミット履歴をグラフ構造で表示
  - `--all`: すべてのブランチを表示
- `git status`: 現在の状況を表示

## 意味を知っておくと理解がはかどるgitの用語

### ワークツリー

現在作業中のディレクトリ。カレントディレクトリ

### インデックス

- コミットのステージング領域
- git commitのコミット対象
- git addは変更をインデックスに登録する

### コミットオブジェクト

- コミットオブジェクト = スナップショット
- 特定時点のファイル全体を保持
  - 差分を持っているわけではない
- SHA1のIDで区別

### ブランチ

- **ブランチ＝コミットオブジェクトについたラベル（ポインタ）**
  &uarr; 最初自分はブランチを枝みたいなものとして捉えてたから目からウロコだった笑
- ブランチに対してコミット
  - 最新コミットに追従

### HEAD

- 現在作業中のコミットを指す特別なラベル
- git diffなどの各種コマンドが暗黙に利用する
- 通常の状態：ブランチにくっついて一緒に動く
  &rarr; "HEAD -> main"：mainにくっついている
- Detached HEAD：ブランチから外れて特定のコミットを指した状態

## 差分表示

- `git diff --cached`：インデックスとリポジトリ（HEAD)の差分
- `git diff`：ワークツリーとインデックスの差分

## checkout

`git checkout main`

- HEADを特定のブランチやコミットに対して設定
- ワークツリーとインデックスをHEADの内容に更新
- コミットを指定するとDetached HEADとなる
  &rarr; バグの調査中に特定のコミットの中身を見たいときなどに使う

## ブランチ操作

### ブランチの作成

- `git branch br-name`：HEADを指すブランチの作成
- `git checkout -b br-name`：HEADを指すブランチを作成し、そのブランチにcheckoutする

### ブランチの削除

- `git branch -d br-name`：br-nameブランチの削除
- `git branch -D br-name`：br-nameブランチの強制削除

### リモート追跡ブランチの削除

`git remote prune origin`：リモート上で削除済みブランチの追跡ブランチを削除

## マージ

- 分岐を一つに統合すること
- 同時並行で変更を加え、それらを統合し新たなコミット（マージコミット）を作成
- mainブランチにbr-aブランチをマージ

```
git checkout main
git merge br-a
```

### Fast-forwardマージ

- Fast-forward：単にポインタを動かすだけで事足りる状況（マージコミットは作られない）
- あえてマージコミットを作る：`git merge --no-ff -m "msg"`
  ![pic1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4135060/9bd16e15-720b-41d7-b391-cc3e72a21a16.png)

## 競合（conflict）

- 同じ箇所を同時並行で変更すること
- どちらの変更を採用するべきか自動決定できない
- 解決法
  - `git status`で競合するファイルを確認しエディタで競合を修正、保存し、`git add` & `git commit`
- 競合の内容

```
<<<<<<< HEAD
HEADの内容
=======
マージしようとした内容
>>>>>>> br-a
```

## rebase

- ベースを付け替える操作

ブランチ作業中に、他の人にmainが更新されてしまった

```
git checkout br-name
git rebase main
```

&rarr; あたかも最新のmainからブランチしたかのようになる

rebase前
![pic2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4135060/7267646a-188f-40a4-b523-0957f038983b.png)
rebase後
![pic3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4135060/8d71a4ec-4c03-452b-85e3-feedf5f8b190.png)

## 歴史を修正する

- `git reflog`：ブランチが過去にどのコミットを指していたか見る
- `git rebase -i 起点となるコミット`：対話的リベース
  - コミット順を並べ替えたり
  - コミットメッセージの変更を指示したり
- `git commit --amend`：コミットの修正
  - 変更の追加・削除
  - コミットメッセージの編集

## 状態のリセット

`git reset`

- `--soft`：HEADを指定したコミットにリセット
  - インデックスとワークツリーは無変化
- `--mixed`：インデックスをリセット
  - git resetのデフォルト動作
- `--hard`：インデックスとワークツリーをリセット
  - コミットしていない変更が消える

## stash

- コミットしたくないけど無くなると困る変更
  - ワークツリーに変更がある場合、checkout できない&rarr; stashするとできる
- 一時的に変更を隠しておく
- stash = 隠し場所
- `git stash save`
- `git stash pop`
  - stash領域はスタック構造
- `git stash list`

## 終わりに

Git は最初こそ覚えることが多くて戸惑いますが、慣れてくると「なるほど、こういう仕組みなんだ」と少しずつ全体が見えてくるのが面白いところです。
今回の記事では、自分が実際に「これ便利だな〜」「もっと早く知ってたら楽だったのに…！」と思った知識やコマンドを紹介しました。

正直、Git って「とりあえず動けばOK」になりがちなんですが、ちょっとした理解があるだけでミスに強くなったり、復旧が簡単になったり、作業がサクサク進むようになったりします。
この記事が、Git を使いこなすきっかけや、ふとしたときに思い出してもらえるような内容になっていれば嬉しいです。
「これも便利だよ！」というコマンドや、「もっといいやり方あるよ！」というものがあれば、ぜひコメントで教えてください！
